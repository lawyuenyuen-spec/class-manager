<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>èª²å®¤ç®¡ç†å°å¹«æ‰‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
    }

    h1 {
      text-align: center;
      margin-bottom: 12px;
      color: #222;
    }

    /* Tabs */
    .tabs {
      display: flex;
      background: #e5e7eb;
      border-radius: 999px;
      padding: 4px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border-radius: 999px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 15px;
      color: #555;
    }

    .tab-btn.active {
      background: white;
      font-weight: bold;
      color: #111;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    /* Pages */
    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Inputs */
    input[type="text"], input[type="number"] {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
    }

    button {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
    }

    .btn-danger {
      background: #dc2626;
      color: white;
    }

    .btn-secondary {
      background: #e5e7eb;
    }

    /* Card */
    .card {
      background: white;
      padding: 14px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      margin-bottom: 12px;
    }

    .flex {
      display: flex;
      align-items: center;
    }

    .between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .student-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .student-card {
      background: white;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }

    .score-num {
      font-size: 24px;
      font-weight: bold;
      margin: 4px 0;
    }

    .plus-btn, .minus-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      font-size: 20px;
      border: none;
      cursor: pointer;
      color: white;
    }

    .plus-btn {
      background: #16a34a;
    }

    .minus-btn {
      background: #dc2626;
    }

    .redeem-btn {
      margin-top: 4px;
      background: #9333ea;
      color: white;
      width: 100%;
      border-radius: 6px;
    }

    /* Group page skeleton */
    .group-section {
      display: flex;
      gap: 20px;
    }

    .group-col {
      flex: 1;
    }

    .group-card {
      background: white;
      padding: 14px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      margin-bottom: 12px;
    }

    /* Homework skeleton */
    .hw-card {
      padding: 12px;
      border-radius: 12px;
      background: white;
      margin-bottom: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
  </style>
</head>

<body>
<div class="container">

  <h1>Class Manager ç­ç´šå°å¹«æ‰‹ v4</h1>

  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" data-page="page-individual">å€‹äººè¨ˆåˆ†</button>
    <button class="tab-btn" data-page="page-group">å°çµ„è¨ˆåˆ†</button>
    <button class="tab-btn" data-page="page-homework">ä½œæ¥­è¨‚æ­£</button>
  </div>
<!-- ========================= -->
<!--     JAVASCRIPT START      -->
<!-- ========================= -->
<script>
/* -------------------------------
   ğŸ§  State Modelï¼ˆè³‡æ–™çµæ§‹ï¼‰
-------------------------------- */
let state = {
  students: [
    // {
    //   id: 123,
    //   seat: "1",
    //   name: "å°æ˜",
    //   totalScore: 0,
    //   individualGroupScoreToday: 0
    // }
  ],

  groups: [
    // { id, name, memberIds: [], groupScore: 0 }
  ],

  homeworks: [
    // { id, title, students: [{ studentId, checked, status }] }
  ]
};

const STORAGE_KEY = "class_manager_v4";

/* -------------------------------
   ğŸ“Œ è¼‰å…¥ LocalStorage
-------------------------------- */
function loadState() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    state = JSON.parse(saved);
  }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* -------------------------------
   ğŸ‘¤ æ–°å¢å­¸ç”Ÿ
-------------------------------- */
function addStudent() {
  const seat = document.getElementById("newSeat").value.trim();
  const name = document.getElementById("newName").value.trim();

  if (!seat || !name) {
    alert("è«‹è¼¸å…¥åº§è™Ÿå’Œå§“å");
    return;
  }

  state.students.push({
    id: Date.now(),
    seat,
    name,
    totalScore: 0,
    individualGroupScoreToday: 0
  });

  saveState();
  renderIndividualPage();

  document.getElementById("newSeat").value = "";
  document.getElementById("newName").value = "";
}

/* -------------------------------
   ğŸ‘¤ å€‹äººé ï¼šåŠ åˆ† / æ‰£åˆ† / å…Œæ›å¡
-------------------------------- */
function changePersonalScore(id, delta) {
  const stu = state.students.find(s => s.id === id);
  if (!stu) return;

  stu.totalScore += delta;
  if (stu.totalScore < 0) stu.totalScore = 0;

  saveState();
  renderIndividualPage();
}

function redeemCard(id) {
  const stu = state.students.find(s => s.id === id);
  if (!stu) return;

  if (stu.totalScore < 5) {
    alert("åˆ†æ•¸ä¸è¶³ï¼Œä¸èƒ½å…Œæ›ï¼");
    return;
  }

  stu.totalScore -= 5;

  saveState();
  renderIndividualPage();
}

/* -------------------------------
   ğŸ‘¤ å€‹äººé ï¼šæ¸²æŸ“
-------------------------------- */
function renderIndividualPage() {
  const container = document.getElementById("individualList");
  container.innerHTML = "";

  // sort by seat number
  const list = [...state.students].sort(
    (a, b) => Number(a.seat) - Number(b.seat)
  );

  list.forEach(stu => {
    const card = document.createElement("div");
    card.className = "student-card";

    card.innerHTML = `
      <div class="between">
        <div><strong>${stu.seat}. ${stu.name}</strong></div>
        <div class="score-num">${stu.totalScore}</div>
      </div>

      <div class="between" style="margin-top:6px;">
        <button class="minus-btn" onclick="changePersonalScore(${stu.id}, -1)">âˆ’</button>
        <button class="plus-btn" onclick="changePersonalScore(${stu.id}, +1)">+</button>
      </div>

      <button class="redeem-btn" onclick="redeemCard(${stu.id})">
        å…Œæ›å¡ï¼ˆ-5 åˆ†ï¼‰
      </button>
    `;

    container.appendChild(card);
  });
}

/* -------------------------------
   ğŸ§© Tabs åˆ‡æ›
-------------------------------- */
function initTabs() {
  const tabs = document.querySelectorAll(".tab-btn");
  const pages = document.querySelectorAll(".page");

  tabs.forEach(btn => {
    btn.addEventListener("click", () => {
      const target = btn.dataset.page;

      // update active tab
      tabs.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      // show target page
      pages.forEach(p => {
        p.classList.toggle("active", p.id === target);
      });
    });
  });
}

/* -------------------------------
   ğŸš€ Init
-------------------------------- */
loadState();
initTabs();
document.addEventListener("DOMContentLoaded", () => {
  renderIndividualPage();
});
</script>
<!-- ========================= -->
<!--  PAGE 2: å°çµ„è¨ˆåˆ†é ï¼ˆéª¨æ¶ï¼‰  -->
<!-- ========================= -->
<div id="page-group" class="page">

  <h2>å°çµ„è¨ˆåˆ†ï¼ˆå»ºæ§‹ä¸­ Â· Step 2 åŠ åŠŸèƒ½ï¼‰</h2>

  <p style="color:#555;">
    â¤ å·¦é‚Šï¼šæœªåˆ†çµ„å­¸ç”Ÿ  
    â¤ å³é‚Šï¼šå°çµ„ï¼ˆå¯æ‹–æ›³å­¸ç”Ÿï¼‰  
    â¤ æ¯å€‹çµ„éƒ½æœ‰ï¼šå€‹äººåˆ†ã€çµ„åˆ†ã€è‡ªå‹•çµç®—ï¼ˆä¸‹ä¸€æ­¥åŠ å…¥ï¼‰
  </p>

  <div class="group-section">

    <!-- å·¦å´ï¼šæœªåˆ†çµ„å­¸ç”Ÿ -->
    <div class="group-col">
      <h3>æœªåˆ†çµ„å­¸ç”Ÿ</h3>
      <div id="ungroupedList" class="student-list">
        <!-- ä¹‹å¾ŒæœƒåŠ å…¥æ‹–æ›³ -->
      </div>
    </div>

    <!-- å³å´ï¼šå°çµ„ -->
    <div class="group-col">
      <h3>å°çµ„åˆ—è¡¨</h3>

      <!-- å¾…åŠ å…¥åŠŸèƒ½ï¼šæ–°å¢å°çµ„æŒ‰éˆ• -->
      <button class="btn-primary" onclick="alert('å°çµ„åŠŸèƒ½æœƒåœ¨ Step 2 å»ºå¥½ï¼')">
        ï¼‹ æ–°å¢å°çµ„
      </button>

      <div id="groupList" style="margin-top:12px;">
        <!-- å°çµ„å¡ç‰‡æœƒåœ¨ Step 2 ç”Ÿæˆ -->
      </div>
    </div>

  </div>

  <hr style="margin:24px 0;">

  <!-- å±éšªå€ / åˆ†çµ„æ’åï¼ˆStep 2 åŠ ï¼‰ -->
  <div>
    <h3>åˆ†çµ„æ’åï¼ˆStep 2 åŠ ï¼‰</h3>
    <div id="groupRanking"></div>

    <h3 style="margin-top:20px;">âš ï¸ å±éšªå€ï¼ˆä»Šæ—¥æœªå¾—åˆ†ï¼‰</h3>
    <div id="dangerZone"></div>
  </div>

</div>

<!-- ========================= -->
<!--  PAGE 3: ä½œæ¥­è¨‚æ­£é ï¼ˆéª¨æ¶ï¼‰ -->
<!-- ========================= -->
<div id="page-homework" class="page">
  <h2>ä½œæ¥­è¨‚æ­£ï¼ˆå»ºæ§‹ä¸­ Â· Step 2 åŠ åŠŸèƒ½ï¼‰</h2>

  <div style="margin-bottom:12px;">
    <input id="newHomeworkTitle" type="text" placeholder="è¼¸å…¥åŠŸèª²åç¨±">
    <button class="btn-primary"
      onclick="alert('ä½œæ¥­åŠŸèƒ½æœƒåœ¨ Step 2 åŠ å…¥ï¼')">
      ï¼‹ æ–°å¢åŠŸèª²
    </button>
  </div>

  <div id="homeworkList">
    <!-- åŠŸèª²å¡ç‰‡æœƒåœ¨ Step 2 åŠ å…¥ -->
  </div>
</div>

<!-- ========================= -->
<!--  NEW STUDENT SECTION      -->
<!-- ========================= -->

<hr style="margin:30px 0;">

<h2>æ–°å¢å­¸ç”Ÿ</h2>

<div class="card">
  <div style="display:flex; gap:12px; align-items:center;">
    <input id="newSeat" type="number" placeholder="åº§è™Ÿ" style="width:90px;">
    <input id="newName" type="text" placeholder="å§“å">
    <button class="btn-primary" onclick="addStudent()">æ–°å¢</button>
  </div>
</div>

<!-- ========================= -->
<!--  HTML END                -->
<!-- ========================= -->

</div> <!-- container end -->
</body>
</html>
